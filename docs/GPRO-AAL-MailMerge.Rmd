
```{r setup, include=FALSE}
library(xlsx)
library(sqldf)
library(plyr)
library(dplyr)
library(reshape2)
library(MASS)
library(manipulate)
library(stringr)
library(CTT)
library(Hmisc)
library(psych)
library(ggplot2)
library(ggpubr)
library(gtable)
library(cowplot)

# Setting the directory for knitr, as the dir is reset after running a code chunk.
library(knitr)
library(kableExtra)

opts_knit$set(root.dir = if(grepl("BiancaClavio", getwd())){'C:/Users/BiancaClavio/Documents/SVN/01Projects/GPRO'} else {paste(homeDir,"~/SVN/01Projects/GPRO/", sep = "")})

# homeDir<-Sys.getenv("HOME")

```


 
```{r include=FALSE, warning=FALSE}
personalized_infoGPRO <- read.csv("studentDataGPRO.csv", stringsAsFactors = FALSE)
personalized_infoGPRO <- personalized_infoGPRO[,-1]
campus <- personalized_infoGPRO$Campus[i]
name <- personalized_infoGPRO$Name[i]
#rowID <- personalized_infoGPRO$rowID[i]



textCampus <- ifelse(personalized_infoGPRO$Campus[i] == 'AAL', "Specifically, they indicate the average score of all students in eight topics, consisting of the self-assessment questions (indicated with SA) and the midterm term questions (indicated with MT). The SA topics refer to the first six self-assessment quizzes and their corresponding lectures (except lecture 3). The midterm exam is a combination of these topics, containing: Course Introduction (Q1-Q2), Variables and Math (Q3-Q13), Branching (Q15-Q18, Q22-Q24), Looping (Q19), and Functions (Q20-Q21). Your score for each topic in the midterm exam is indicated with red dots, and your average score from the self-assessment quizzes from Moodle is indicated with blue dots for each topic.", "Specifically, they indicate the average score of all students in eight topics, consisting of the midterm term questions: Course Introduction (Q1-Q2), Variables and Math (Q3-Q13), Branching (Q15-Q18, Q22-Q24), Looping (Q19), and Functions (Q20-Q21). Your score for each topic in the midterm exam is indicated with red dots." )


```

---
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[RE,RO]{`r name`}
- \fancyhead[LE,LO]{Medialogy, `r campus`, 2017}
- \fancyfoot[CE,CO]{MIDTERM EXAM IN GPRO}
- \fancyfoot[LE,RO]{\thepage}
output:
  pdf_document: default
urlcolor: blue
---


# Midterm Exam - Student Report

This is an interpretive report of your responses to the midterm exam in introduction to programming (GPRO). Its purpose is to help you identify your strengths and weaknesses in the course topics.

The boxplots[^1] show how you compare to a larger sample of first semester Medialogy students from Aalborg and Copenhagen (see Figure 1). 
`r textCampus`
The scores are normalized for each topics on a scale from 0 to 1, indicating the lowest and highest possible scores for the topic.
A score above 0.5 means that you received more than half of the point denoted for the particular topic in the test. The percentiles indicate the percentage of students whose scores are equal to or less than yours. 

[^1]: A *boxplot* illustrates the full range of variation (from min to max), the likely range of variation called the interquartile range (IQR) and a typical value (median). The rectangular box denotes the IQR, corresponding to the middle scores of the dataset - ranging from the 25th to the 75th percentile. The line dividing the box into two parts marks the median. The horizontal lines to the left and right of the IQR (whiskers) are 1.5 times as long as the width of the IQR. Outliers are defined as data points outside the whisker ranges and plotted as black dots.



```{r include=FALSE}
i <- 1
student <- subset(avgMidtermGradesMelt, avgMidtermGradesMelt$rowID == i)

#avgMidtermGradesMelt$variable <- gsub("\\.", " ", avgMidtermGradesMelt$variable)
# avgMidtermGradesMelt$variable <- factor(avgMidtermGradesMelt$variable,
#   levels = c('Functions.x','Functions.y', 'Looping.x', 'Looping.y',
#   'Branching.x', 'Branching.y','VariablesDataMaths.x', 'VariablesDataMaths.y',
#   'CourseIntroduction.x', 'CourseIntroduction.y'),ordered = TRUE)

avgMidtermGradesMelt$variable <- gsub("CourseIntroduction.x","Course Introduction MT",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("CourseIntroduction.y","Course Introduction SA",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("VariablesDataMaths.x","Variables and Math MT",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("VariablesDataMaths.y","Variables and Math SA",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("Branching.x","Branching MT",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("Branching.y","Branching SA",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("Looping.x","Looping MT",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("Looping.y","Looping SA",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("Functions.x","Functions MT",avgMidtermGradesMelt$variable)
avgMidtermGradesMelt$variable <- gsub("Functions.y","Functions SA",avgMidtermGradesMelt$variable)

avgMidtermGradesMelt$variable <- factor(avgMidtermGradesMelt$variable,
  levels = c('Functions MT','Functions SA', 'Looping MT', 'Looping SA',
  'Branching MT', 'Branching SA','Variables and Math MT', 'Variables and Math SA',
  'Course Introduction MT', 'Course Introduction SA'),ordered = TRUE)

# avgMidtermGradesMelt$variable <- factor(avgMidtermGradesMelt$variable,
#   levels = c('Functions.x', 'Looping.x', 
#   'Branching.x', 'VariablesDataMaths.x', 
#   'CourseIntroduction.x'),ordered = TRUE)


# avgMidtermGradesMelt$variable <- factor(avgMidtermGradesMelt$variable,
#   levels = c('Functions (Q20-Q21)', 'Loops (Q19)',
#   'Nesting (Q18, Q22-Q23)','Logical expressions (Q15-Q17, Q24)','Mouse and keyboard input (Q14)',
#   'Math and expressions (Q10-Q13)','Variables and data types (Q3-Q9)',
#   'Programming rules (Q1-Q2)'),ordered = TRUE)

 pScore <- ggplot(avgMidtermGradesMelt, aes(x=variable, y=value, group=variable)) + 
  geom_boxplot() + #aes(fill=type)
  #scale_fill_hue(l=80, c=50) + # lightness (l) chroma (c, intensity of color)
  coord_flip() +
  labs(y="Figure 1: Boxplots of the scores of all students in eleven topics.") +
  geom_dotplot(data = student,
               aes(x=variable, y=value, fill = type),
               binaxis='y',
               stackdir='center',
               binwidth = 0.05) +
  theme_bw() +
  #facet_grid(Campus ~ .) +
  theme(plot.margin = margin(35, 1, 1, 1),
        axis.title.y=element_blank(),
        #axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        #axis.title.x=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none")

```


```{r include=FALSE, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE} 

studentTable <- melt(subset(personalized_infoGPRO[,-c(1,12,23:25)], personalized_infoGPRO$rowID %in% personalized_infoGPRO$rowID[i]))
studentTable1<- NULL
studentTable1 <- data.frame(c(studentTable[-c(11:20),]), c(studentTable[-c(1:10),-c(1)]))
studentTable1 <- studentTable1[c(10,5,9,4,8,3,7,2,6,1), ]

names(studentTable1)[2]<-"Your score"
names(studentTable1)[3]<-"Percentile rank"
row.names(studentTable1) <- NULL
#studentTable1$`Your score` <- as.numeric(levels(studentTable1$`Your score`))[studentTable1$`Your score`]
studentTable1 <- studentTable1[,-c(1)]

is.num <- sapply(studentTable1, is.numeric)
studentTable1[is.num] <- sapply(studentTable1[is.num], round, 2)
studentTable1$`Percentile rank` <- round(as.numeric(studentTable1$`Percentile rank`), digits = 0)
studentTable1 <- rbind(studentTable1, c(" "))

tabData <- ggtexttable(studentTable1, rows = NULL, theme = ttheme(base_style = "blank", padding = unit(c(5, 7), "mm")))
showAnalysis <- ggarrange(pScore, tabData, ncol = 2, nrow = 1, align = "h", widths = c(3,2))
```

```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
showAnalysis

```


