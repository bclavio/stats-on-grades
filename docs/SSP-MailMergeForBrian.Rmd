
```{r setup, include=FALSE}
library(xlsx)
library(sqldf)
library(plyr)
library(dplyr)
library(reshape2)
library(MASS)
library(manipulate)
library(stringr)
library(CTT)
library(Hmisc)
library(psych)
library(ggplot2)
library(ggpubr)
library(gtable)
library(cowplot)

# Setting the directory for knitr, as the dir is reset after running a code chunk.
library(knitr)
library(kableExtra)

# Brian: change dir:
opts_knit$set(root.dir = "C:/Users/BiancaClavio/Documents/stats-on-grades/docs")
homeDir<-Sys.getenv("HOME")
#opts_knit$set(root.dir = paste(homeDir,"/git/AAU/dropOutProject/analysis/docs", sep = ""))

```


 
```{r include=FALSE, warning=FALSE}
personalized_info <- read.csv("studentData.csv", stringsAsFactors = FALSE)
score_info <- read.csv("studentData1.csv", stringsAsFactors = FALSE)
highRiskStudents <- read.csv(file = "highRiskStudents.csv", stringsAsFactors = FALSE)
campus <- personalized_info$Campus[i]
firstname <- personalized_info$FirstName[i]
surname <- personalized_info$SurName[i]
rowID <- personalized_info$rowID[i]

```

---
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[RE,RO]{`r firstname` `r surname`}
- \fancyhead[LE,LO]{Medialogy, `r campus`, 2017}
- \fancyfoot[CE,CO]{STUDY VERIFICATION TEST}
- \fancyfoot[LE,RO]{\thepage}
output:
  pdf_document: default
urlcolor: blue
---


# Study Verification Test - Student Report

This is an interpretive report of your responses to the study verification test. Its purpose is to help you identify your student profile within specific topics.

The boxplots[^1]  show how you compare to a larger sample of first semester Medialogy students from Aalborg and Copenhagen. Specifically, they indicate the average self-ratings of all students in seven different topics (see Figure 1) and the self-reported study hours per week (see Figure 2). Your self-reported value for each topic is indicated with red dots. A value less than 0.5 means that you rated yourself lower than the average student. The percentiles indicate the percentage of students whose scores are equal to or less than yours. Based on these results we have created specific recommendations for you to get more comfortable in the Medialogy study environment. 


As the report is based on the questionnaire information alone, it may give only a rough indication of your true attitudes. Your advisor or student counselor will help you understand your scores and find the services you desire.

[^1]: A *boxplot* consists of four equal sized groups made from the ordered scores, i.e. 25% of all scores are placed in each group. The lines dividing the groups are called quartiles. The rectangular box denotes the middle 50% of scores for the group, and its lengyh is equal to the difference between the 75th and 25th percentiles. The median (middle quartile) marks the mid-point of the data, indicated as the line dividing the box into two parts. The upper and lower lines (also called whiskers) represent scores outside the middle 50%. Outliers are defined as data points outside the whiskers and plotted as black dots. 



```{r include=FALSE}

score_info$variable <- as.character(score_info$variable)
score_info$variable <- factor(score_info$variable, levels=unique(score_info$variable))

student <- subset(norm.avgGradesMelt, norm.avgGradesMelt$rowID %in% highRiskStudents$rowID[i])

pScore <- ggplot(norm.avgGradesMelt, aes(x=variable, y=value)) +
  geom_boxplot() + 
  coord_flip() +
  labs(y="Figure 1: Boxplots of the self-ratings in seven topic of all students.") +
  geom_dotplot(data = student,
               aes(x=variable, y=value, fill = "student data"),
               binaxis='y',
               stackdir='center',
               binwidth = 0.04) +
  theme_bw() +
  #facet_grid(Campus ~ .) +
  theme(plot.margin = margin(35, 1, 1, 1), # 20
        axis.title.y=element_blank(),
        #axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        #axis.title.x=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none")

```


```{r include=FALSE, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE} 
studentTable <- melt(subset(personalized_info[,-c(1:5, 20:31)], personalized_info$rowID %in% personalized_info$rowID[i]))
studentTable1<- NULL
studentTable1 <- data.frame(c(studentTable[-c(1:7),-c(1)]), apply(studentTable[-c(8:14), ], 2, rev))
studentTable1 <- studentTable1[, c(2,3,1)]
names(studentTable1)[2]<-"Your score"
names(studentTable1)[3]<-"Percentile rank"
row.names(studentTable1) <- NULL
studentTable1$`Your score` <- as.numeric(levels(studentTable1$`Your score`))[studentTable1$`Your score`]
studentTable1 <- studentTable1[,-c(1)]

is.num <- sapply(studentTable1, is.numeric)
studentTable1[is.num] <- sapply(studentTable1[is.num], round, 2)
studentTable1$`Percentile rank` <- round(as.numeric(studentTable1$`Percentile rank`), digits = 0)
studentTable1 <- rbind(studentTable1, c(" "))


tabData <- ggtexttable(studentTable1, rows = NULL, theme = ttheme(base_style = "blank", padding = unit(c(2, 10), "mm")))
showAnalysis <- ggarrange(pScore, tabData, ncol = 2, nrow = 1, align = "h", widths = c(2.5,1.5)) # , common.legend = TRUE
```

```{r, echo=FALSE, warning=FALSE, error=FALSE, message=FALSE}
showAnalysis

```


